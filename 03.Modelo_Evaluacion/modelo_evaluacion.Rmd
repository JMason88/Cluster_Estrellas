---
title: "modelado_validacion"
author: "JMason88"
date: "14 de octubre de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Limpio Memoria

```{r}
rm(list = ls())

```

#Llamo librerías

```{r}
library(tidyr)
library(tidyverse)
library(ggplot2)
library(readr)
library(cluster)
library(factoextra)
library(NbClust)

```

Levanto primera version de pre-procesamiento.

```{r}
hip1 <- read_csv("../02.Preprocesamiento/hip_version1.csv")

```

Análisis de tendencia de clusterización ¿existen indicios para pensar que este dataset podría ser clusterizable?


Grafico PCA para ver posicionamiento de la Hyades

```{r}
library(ggsci)
fviz_pca_biplot(prcomp(hip1[,-c(1,9)]), title = "PCA - Hipparcos", 
             habillage = hip1$Symbad_Hyades,  palette = "uchicago",
             geom = "point", ggtheme = theme_classic(),
             legend = "bottom")


```

A través del gráfico de PCA se puede observar que las Hyades se encuentran concentradas.

```{r}
set.seed(123)

gradient.color <- list(low = "steelblue",  high = "white")

hip1 %>% 
  select(., -HIP, -Symbad_Hyades) %>%
  get_clust_tendency(n=nrow(.)-1, gradient = gradient.color) #Ojo que tarda mucho con n-1 grados de libertad


```

El estadístico de Hopkins parecería indicar que este conjunto no es clusterizable, ya que su valor es cercano a 0. (Un conjunto con fuerte tendencia a la clusterización debería tener un estadístico >0.5)

Sin embargo para este caso no queremos clusterizar perfectamente todo el dataset. Solamente nos interesa clusterizar las hyades.

A continuación realizará el análisis de Cluster tomando en cuenta distintas medidas de distancia posibles.

##Analisis utilizando K-medias

-Distancia Euclídea

```{r}
source("NbClust2_kmeans.r")
kmeans_euclid <- NbClust2(data = hip1[,-c(1,9)], distance = "euclidean", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_euclid
```

-Distancia Máxima

```{r}
kmeans_max <- NbClust2(data = hip1[,-c(1,9)], distance = "maximum", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_max
```

-Distancia de Manhattan

```{r}
kmeans_manhattan <- NbClust2(data = hip1[,-c(1,9)], distance = "manhattan", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_manhattan

```

-Distancia de Canberra

```{r}
kmeans_canberra <- NbClust2(data = hip1[,-c(1,9)], distance = "canberra", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_canberra

```

-Distancia Binaria

```{r}

kmeans_bin <- NbClust2(data = hip1[,-c(1,9)], distance = "binary", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_bin


```

-Distancia de Minkowski

```{r}
kmeans_minkowski <- NbClust2(data = hip1[,-c(1,9)], distance = "minkowski", min.nc = 2, max.nc = 10, method = "kmeans", index = "all", max.iter = 25)
kmeans_minkowski

```


```{r}
hip_clust <- cbind(hip1, kmeans_bin[["Best.partition"]])
fviz_pca_ind(prcomp(hip_clust[,-c(1,9,10)]), 
                title = "PCA - Hipparcos Kmeans",
                habillage = hip_clust$`kmeans_bin[["Best.partition"]]`,
                palette = "uchicago",
                geom = "point", 
                ggtheme = theme_classic(),
                legend = "bottom", axes = c(1,2))
```

```{r}
set.seed(1)
hip_kmeans_final <- hip1 %>% select(., -c(1,9)) %>% kmeans(., 2)

table(hip_kmeans_final$cluster)

hip_clust1 <- cbind(hip1, hip_kmeans_final$cluster)
fviz_pca_ind(prcomp(hip_clust1[,-c(1,9,10)]), 
                title = "PCA - Hipparcos Kmeans",
                habillage = hip_kmeans_final$cluster,
                palette = "uchicago",
                geom = "point", 
                ggtheme = theme_classic(),
                legend = "bottom", axes = c(1,2))
```

```{r}
sil_kmeans_final <- silhouette(hip_kmeans_final$cluster, dist(hip1[,-c(1,9)], method = "canberra"))

plot(sil_kmeans_final, main="Silhouette, k = 2",col=1:2 ,border = NA)

```



```{r}
hip_clust %>% filter(., Symbad_Hyades == T)
```


```{r}
hip_clust <- hip1 %>% cbind(., 
                            kmeans_euclid = kmeans_euclid[["Best.partition"]], 
                            kmeans_max = kmeans_max[["Best.partition"]], 
                            kmeans_manhattan = kmeans_manhattan[["Best.partition"]], 
                            kmeans_canberra = kmeans_canberra[["Best.partition"]], 
                            kmeans_bin = kmeans_bin[["Best.partition"]], 
                            kmeans_minkowski = kmeans_minkowski[["Best.partition"]])

hip_clust %>% filter(., Symbad_Hyades == T) %>% select(., c(1,9:15))

write_csv(hip_clust, "hip_clust.csv")
```

```{r}

```

```{r}

```

```{r}

```

